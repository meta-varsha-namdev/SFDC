trigger StageChangedToAnotherValue on Opportunity (before update, after update) 
{
    if(trigger.isBefore)
    {
        for(Opportunity opp : trigger.new)
        {
            if(opp.StageName == 'CLOSED_WON' || opp.StageName=='CLOSED_LOST')
            {
                opp.CloseDate = System.today();
            }
            
            if((Trigger.oldMap.get(opp.Id).StageName != 'Closed Won' || Trigger.oldMap.get(opp.Id).StageName != 'Closed Won') 
			&& (opp.StageName == 'Closed Won' || opp.StageName == 'Closed Lost')){
        }        
    }
    
    if(trigger.isAfter)
    {
        if(trigger.isUpdate)
        {
            Set<id> opportunityIdset = new Set<id>();
            for(Opportunity opp : trigger.new)
            {
                if(opp.Custom_Status__c == 'Reset')
                {
                    opportunityIdset.add(opp.Id);
                }
                
                delete [SELECT Id FROM OpportunityLineItem where OpportunityId IN :opportunityIdset];
            }             
        }       
    }
}
}